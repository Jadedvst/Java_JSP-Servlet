package fileupload;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.List;
import java.util.Map;
import java.util.Vector;
import common.JDBConnect;
import jakarta.servlet.ServletContext;

public class MyFileDAO extends JDBConnect {
	
	public MyFileDAO(String drv,String url, String id,String pw) {
		super(drv,url,id,pw);
	}
	
	public MyFileDAO(ServletContext application) {
		super(application);
	}
	
	public MyFileDAO() {
		super();
	}

	public int insertFile(MyFileDTO dto) {
		int result = 0;

		String query = "INSERT INTO myfile(title,cate,ofile,sfile) Values ("
				+ "?,?,?,?)";
		PreparedStatement ps = null;
		
		try {
			ps = getCon().prepareStatement(query);
			ps.setString(1, dto.getTitle());
			ps.setString(2, dto.getCate());
			ps.setString(3, dto.getOfile());
			ps.setString(3, dto.getSfile());
			
			result = ps.executeUpdate();
			
		}catch(Exception e) {
			System.out.println("Insert 중 예외 발생 ("+e.getMessage()+")");
			e.printStackTrace();
			return 0;
		}finally {
			try {
				if(ps!=null) ps.close();
			}catch(Exception e) {
				e.printStackTrace();
			}
		}
		return result;
	}
	
	public List<MyFileDTO> myFileList() {
		List<MyFileDTO> filelist = new Vector<>();
		
		Statement st = null;
		ResultSet rs = null;
		MyFileDTO dto = null;
		
		String query = "SELECT * FROM myfile ORDER BY idx DESC ";
		
		try {
			st = getCon().createStatement();
			rs = st.executeQuery(query);
			while(rs.next()) {
				dto = new MyFileDTO();
				dto.setNum(rs.getInt(1));
				dto.setTitle(rs.getString(2));
				dto.setContent(rs.getString(3));
				dto.setId(rs.getString(4));
				dto.setPostdate(rs.getDate(5));
				dto.setVisitcount(rs.getInt(6));
				
				bbs.add(dto);
			}
		
		}catch(Exception e) {
			System.out.println("게시물 조회 중 예외 발생");
			e.printStackTrace();
		}
		return bbs;
	}
	
}
